/*! indexedDBmock 24-03-2015 */
!function(a){var b=1,c={},d={open:function(a,d){var j,k={};for(var l in c)l===a&&(j=c[l]);j||(d||(d=1),j=new f(a),c[a]=j);var m=new g(j);return d&&m.version>d?setTimeout(function(){"function"==typeof k.onerror&&(k.target=k,k.target.errorCode="VersionError",k.target.error={name:"VersionError"},k.target.readyState="done",k.onerror(k))},b):d&&m.version<d?setTimeout(function(){k.target=k,k.target.readyState="done",k.target.type="upgradeneeded",k.target.newVersion=d,k.target.oldVersion=m.version,k.target.transaction=new i(null,e.VERSIONCHANGE,new h(j,m)),k.target.transaction.db.version=d,m.version=d,j.version=d,"function"==typeof k.onupgradeneeded&&(k.onupgradeneeded(k),k.target.transaction.__commit()),setTimeout(function(){k.target.transaction._aborted?"function"==typeof k.onerror&&(k.target=k,k.target.errorCode=8,k.target.error={name:"AbortError",message:"The transaction was aborted."},k.target.readyState="done",k.onerror(k)):"function"==typeof k.onsuccess&&(k.target=k,k.target.result=m,k.target.readyState="done",j.connections.push(m),k.onsuccess(k));for(var a=0;a<j.connections.length;a++)j.connections[a]._connectionId!==m._connectionId&&"function"==typeof j.connections[a].onversionchange&&(j.connections[a].target=j.connections[a],j.connections[a].target.readyState="done",j.connections[a].target.type=e.VERSIONCHANGE,j.connections[a].target.version=d,j.connections[a].onversionchange(j.connections[a]))},b)},b):setTimeout(function(){"function"==typeof k.onsuccess&&(k.target=k,k.target.result=m,k.target.readyState="done",j.connections.push(m),k.onsuccess(k))},b),k},deleteDatabase:function(a){var d={};for(var e in c)e===a&&(c[e]=void 0,delete c[e]);return setTimeout(function(){"function"==typeof d.onsuccess&&(d.target=d,d.target.readyState="done",d.onsuccess(d))},b),d},cmp:function(){}},e={READONLY:"readonly",READWRITE:"readwrite",VERSIONCHANGE:"versionchange"},f=function(a){this.name=a,this.version=0,this.objectStoreNames=[],this.objectStores=[],this.connections=[],this.transactions=[]},g=function(a){this.name=a.name,this.version=a.version,this.objectStoreNames=a.objectStoreNames,this._connectionId=a.connections.length,this._db=a},h=function(a,b){this.name=a.name,this.version=a.version,this.objectStoreNames=a.objectStoreNames,this._db=a,this._connection=b,this._objectStores=a.objectStores||[]},i=function(a,b,c){if(this.db=c,this.__active=!0,this._aborted=!1,this.__actions=[],b||(b=e.READONLY),b!==e.VERSIONCHANGE&&(!a||0===a.length))throw this.aborted=!0,this.__checkFinished(this),{name:"InvalidAccessError"};if(b!==e.READONLY&&b!==e.READWRITE&&b!==e.VERSIONCHANGE&&(b=e.READONLY),a)for(var d=0;d<a.length;d++){for(var f=!1,g=0;g<c.objectStoreNames.length;g++)c.objectStoreNames[g]===a[d]&&(f=!0);if(!f)throw this.aborted=!0,this.__checkFinished(this),{name:"NotFoundError"}}this.mode=b,this.objectStoreNames=a,this.db.transaction=this,this.__checkFinished(this)},j=function(a,b,c){this.name=a,this.keyPath=b?b.keyPath:void 0,this.autoIncrement=b?b.autoIncrement:void 0,this.indexNames=[],this.transaction=c,this._indexes=[],this.__data={},this.__actions=[],this.__latestKey=0},k=function(){},l=function(a,b,c,d){this.name=a,this.keyPath=b,this.multiEntry=c?c.multiEntry:void 0,this.unique=c?c.unique:void 0,this.objectStore=d,this.__data={}};g.prototype=function(){function a(){for(var a=0;a<this._db.connections.length;a++)this._db.connections[a].connectionId===this._connectionId&&this._db.connections.splice(a,1)}function b(a,b){var c=new i(a,b,new h(this._db,this));return c}return{close:a,transaction:b}}(),h.prototype=function(){function a(){this._connection.close()}function b(){this._db.objectStores=this._objectStores,this._db.objectStoreNames=this.objectStoreNames}function c(a,b){return this._connection.transaction(a,b)}function d(a,b){if(this.transaction.mode!==e.VERSIONCHANGE)throw{name:"InvalidStateError"};if(b&&b.keyPath instanceof Array)for(var c=0;c<b.keyPath.length;c++)if(""===b.keyPath[c])throw this.transaction.abort(),{name:"InvalidAccessError"};var d=new j(a,b,this.transaction);return this._objectStores.push(d),this.objectStoreNames.push(a),d}function f(a){if(this.transaction.mode!==e.VERSIONCHANGE)throw{name:"InvalidStateError"};for(var b=!1,c=0;c<this.objectStoreNames.length;c++)this.objectStoreNames[c]===a&&(this.objectStoreNames.splice(c,1),b=!0);if(!b)throw{name:"NotFoundError"};for(var d=0;d<this._objectStores.length;d++)this._objectStores[d].name===a&&this._objectStores.splice(d,1)}return{close:a,transaction:c,createObjectStore:d,deleteObjectStore:f,__commit:b}}(),i.prototype=function(){function a(){for(var a=0;a<this.db._objectStores.length;a++){var b=(new Date).getTime();this.__actions.push(b),g(this,this.db._objectStores[a],b)}}function c(a){a._aborted||a.__commited||(a.__commited=!0,"readonly"!=this.mode&&a.db.__commit(),a.__active=!1,"function"==typeof a.oncomplete&&(a.target=a,a.target.result=a,a.target.readyState="done",a.oncomplete(a)))}function d(){this._aborted=!0;var a=this;setTimeout(function(){"function"==typeof a.onabort&&(a.target=a,a.target.errorCode=8,a.target.error={name:"AbortError",message:"The transaction was aborted."},a.target.readyState="done",a.onabort(a))},b)}function f(a){var b=(new Date).getTime();if(this.__actions.push(b),this.mode!==e.VERSIONCHANGE){for(var c=!1,d=0;d<this.objectStoreNames.length;d++)this.objectStoreNames[d]===a&&(c=!0);if(!c)throw this.__actions.splice(this.__actions.indexOf(b),1),g(this,void 0,b),{name:"NotFoundError"}}for(var f=0;f<this.db._objectStores.length;f++)if(this.db._objectStores[f].name===a){var h=this.db._objectStores[f];return h.transaction=this,g(this,h,b),h}throw this.__actions.splice(this.__actions.indexOf(b),1),g(this,void 0,b),{name:"NotFoundError"}}function g(a,d,e){setTimeout(function(){d?d.__finished()?(a.__actions.splice(a.__actions.indexOf(e),1),0===a.__actions.length&&c(a)):g(a,d,e):0===a.__actions.length&&c(a)},b)}return{abort:d,objectStore:f,__commit:a,__checkFinished:g}}(),j.prototype=function(){function a(b){if("number"==typeof b&&!isNaN(b)||"string"==typeof b||b instanceof Date&&!isNaN(b))return!0;if(b instanceof Array){for(var c=b.length-1;c>=0;c--)if(!a(b[c]))return!1;return!0}return!1}function c(a){return"Object"===a.constructor.name}function d(a){var b={};return a&&"[object Function]"===b.toString.call(a)}function f(a,b){for(var c=b.split("."),d=a,e=0;e<c.length;e++)d&&(d=d[c[e]]);return d}function g(a,b,c){for(var d=b.split("."),e=a,f=0;f<d.length;f++)f!=d.length-1?(e[d[f]]={},e=e[d[f]]):e[d[f]]=c;return e}function h(a){for(var b in a){if(d(a[b]))return!0;if(c(b)&&h(a[b]))return!0}return!1}function i(){}function j(d,i){var j=this,k=(new Date).getTime();j.__actions.push(k);var l={},m=i;if(this.transaction.mode==e.READONLY)throw j.__actions.splice(j.__actions.indexOf(k),1),{name:"ReadOnlyError"};if(!this.keyPath&&!i&&!this.autoIncrement||this.keyPath&&(i||!d[this.keyPath]&&!this.autoIncrement||!c(d)))throw j.__actions.splice(j.__actions.indexOf(k),1),{name:"DataError"};if(this.autoIncrement){if(m&&"number"==typeof m&&m>this.__latestKey||(m=this.__latestKey+1,this.keyPath&&g(d,this.keyPath,m)),m>9007199254740992)throw j.__actions.splice(j.__actions.indexOf(k),1),{name:"ConstraintError"};this.__latestKey=m}else this.keyPath&&(m=f(d,this.keyPath));if(!a(m))throw j.__actions.splice(j.__actions.indexOf(k),1),{name:"DataError"};if(j.__data[m])throw j.__actions.splice(j.__actions.indexOf(k),1),{name:"ConstraintError"};if(h(d))throw j.__actions.splice(j.__actions.indexOf(k),1),{name:"DataCloneError"};for(var n=0;n<this._indexes.length;n++){var o=this._indexes[n],p=f(d,o.keyPath);if(p)if(o.multiEntry&&p instanceof Array){for(var q={},r=0;r<p.length;r++)if(a(p[r])&&!q[p[r]]){if(q[p[r]]=p[r],o.unique&&o.__data[p[r]])throw j.__actions.splice(j.__actions.indexOf(k),1),{name:"ConstraintError"};o.__data[p[r]]||(o.__data[p[r]]=[]),o.__data[p[r]].push({key:i,data:d})}}else{if(!a(p))continue;if(o.unique&&o.__data[p])throw j.__actions.splice(j.__actions.indexOf(k),1),{name:"ConstraintError"};o.__data[p]||(o.__data[p]=[]),o.__data[p].push({key:i,data:d})}}return j.__data[m]=d,setTimeout(function(){"function"==typeof l.onsuccess&&(l.target=l,l.target.result=m,l.target.readyState="done",l.onsuccess(l)),j.__actions.splice(j.__actions.indexOf(k),1)},b),l}function k(a,b,c){if(this.transaction.mode!==e.VERSIONCHANGE)throw{name:"InvalidStateError"};if(b&&b instanceof Array)for(var d=0;d<b.length;d++)if(""===b[d])throw this.transaction.abort(),{name:"InvalidAccessError"};var f=new l(a,b,c,this);return this._indexes.push(f),this.indexNames.push(a),f}function m(a){if(this.transaction.mode!==e.VERSIONCHANGE)throw{name:"InvalidStateError"};for(var b=!1,c=0;c<this.indexNames.length;c++)this.indexNames[c]===a&&(this.indexNames.splice(c,1),b=!0);if(!b)throw{name:"NotFoundError"};for(var d=0;d<this._indexes.length;d++)this._indexes[d].name===a&&this._indexes.splice(d,1)}function n(a){if(this.mode!==e.VERSIONCHANGE){for(var b=!1,c=0;c<this.indexNames.length;c++)this.indexNames[c]===a&&(b=!0);if(!b)throw{name:"NotFoundError"}}for(var d=0;d<this._indexes.length;d++)if(this._indexes[d].name===a)return this._indexes[d].objectStore=this,this._indexes[d];throw{name:"NotFoundError"}}function o(){return 0===this.__actions.length}return{get:i,add:j,createIndex:k,deleteIndex:m,index:n,__finished:o}}(),l.prototype=function(){function a(){}return{get:a}}(),a.indexedDBmock=d,a.IDBCursormock=k,a.IDBDatabasemock=h,a.IDBTransactionmock=i,a.IDBObjectStoremock=j,a.IDBRequestmock=j,a.IDBIndexmock=l,a.indexedDBmockDbs=c}(window||self);