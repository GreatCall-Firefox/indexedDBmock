/*! indexedDBmock 30-03-2015 */
!function(a){var b=1,c={},d={open:function(a,d){var j,k={};for(var l in c)l===a&&(j=c[l]);j||(d||(d=1),j=new f(a),c[a]=j);var m=new g(j);return d&&m.version>d?setTimeout(function(){"function"==typeof k.onerror&&(k.target=k,k.target.errorCode="VersionError",k.target.error={name:"VersionError"},k.target.readyState="done",k.onerror(k))},b):d&&m.version<d?setTimeout(function(){k.target=k,k.target.readyState="done",k.target.type="upgradeneeded",k.target.newVersion=d,k.target.oldVersion=m.version,k.target.transaction=new i(null,e.VERSIONCHANGE,new h(j,m)),k.target.transaction.db.version=d,m.version=d,j.version=d,"function"==typeof k.onupgradeneeded&&(k.onupgradeneeded(k),k.target.transaction.__commit()),setTimeout(function(){k.target.transaction._aborted?"function"==typeof k.onerror&&(k.target=k,k.target.errorCode=8,k.target.error={name:"AbortError",message:"The transaction was aborted."},k.target.readyState="done",k.onerror(k)):"function"==typeof k.onsuccess&&(k.target=k,k.target.result=m,k.target.readyState="done",j.connections.push(m),k.onsuccess(k));for(var a=0;a<j.connections.length;a++)j.connections[a]._connectionId!==m._connectionId&&"function"==typeof j.connections[a].onversionchange&&(j.connections[a].target=j.connections[a],j.connections[a].target.readyState="done",j.connections[a].target.type=e.VERSIONCHANGE,j.connections[a].target.version=d,j.connections[a].onversionchange(j.connections[a]))},b)},b):setTimeout(function(){"function"==typeof k.onsuccess&&(k.target=k,k.target.result=m,k.target.readyState="done",j.connections.push(m),k.onsuccess(k))},b),k},deleteDatabase:function(a){var d={};for(var e in c)e===a&&(c[e]=void 0,delete c[e]);return setTimeout(function(){"function"==typeof d.onsuccess&&(d.target=d,d.target.readyState="done",d.onsuccess(d))},b),d},cmp:function(){}},e={READONLY:"readonly",READWRITE:"readwrite",VERSIONCHANGE:"versionchange"},f=function(a){this.name=a,this.version=0,this.objectStoreNames=[],this.objectStores=[],this.connections=[],this.transactions=[]},g=function(a){this.name=a.name,this.version=a.version,this.objectStoreNames=a.objectStoreNames,this._connectionId=a.connections.length,this._db=a},h=function(a,b){this.name=a.name,this.version=a.version,this.objectStoreNames=a.objectStoreNames,this._db=a,this._connection=b,this._objectStores=a.objectStores||[]},i=function(a,b,c){if(this.db=c,this.__active=!0,this._aborted=!1,this.__actions=[],b||(b=e.READONLY),b!==e.VERSIONCHANGE&&(!a||0===a.length))throw this.aborted=!0,this.__checkFinished(this),{name:"InvalidAccessError"};if(b!==e.READONLY&&b!==e.READWRITE&&b!==e.VERSIONCHANGE&&(b=e.READONLY),a)for(var d=0;d<a.length;d++){for(var f=!1,g=0;g<c.objectStoreNames.length;g++)c.objectStoreNames[g]===a[d]&&(f=!0);if(!f)throw this.aborted=!0,this.__checkFinished(this),{name:"NotFoundError"}}this.mode=b,this.objectStoreNames=a,this.db.transaction=this,this.__checkFinished(this)},j=function(a,b,c){this.name=a,this.keyPath=b?b.keyPath:void 0,this.autoIncrement=b?b.autoIncrement:void 0,this.indexNames=[],this.transaction=c,this._indexes=[],this.__data={},this.__actions=[],this.__latestKey=0},k=function(){},l=function(a,b,c,d){this.name=a,this.keyPath=b,this.multiEntry=c?c.multiEntry:void 0,this.unique=c?c.unique:void 0,this.objectStore=d,this.__data={}};g.prototype=function(){function a(){for(var a=0;a<this._db.connections.length;a++)this._db.connections[a].connectionId===this._connectionId&&this._db.connections.splice(a,1)}function b(a,b){var c=new i(a,b,new h(this._db,this));return c}return{close:a,transaction:b}}(),h.prototype=function(){function a(){this._connection.close()}function b(){this._db.objectStores=this._objectStores,this._db.objectStoreNames=this.objectStoreNames}function c(a,b){return this._connection.transaction(a,b)}function d(a,b){if(this.transaction.mode!==e.VERSIONCHANGE)throw{name:"InvalidStateError"};if(b&&b.keyPath instanceof Array)for(var c=0;c<b.keyPath.length;c++)if(""===b.keyPath[c])throw this.transaction.abort(),{name:"InvalidAccessError"};var d=new j(a,b,this.transaction);return this._objectStores.push(d),this.objectStoreNames.push(a),d}function f(a){if(this.transaction.mode!==e.VERSIONCHANGE)throw{name:"InvalidStateError"};for(var b=!1,c=0;c<this.objectStoreNames.length;c++)this.objectStoreNames[c]===a&&(this.objectStoreNames.splice(c,1),b=!0);if(!b)throw{name:"NotFoundError"};for(var d=0;d<this._objectStores.length;d++)this._objectStores[d].name===a&&this._objectStores.splice(d,1)}return{close:a,transaction:c,createObjectStore:d,deleteObjectStore:f,__commit:b}}(),i.prototype=function(){function a(){for(var a=0;a<this.db._objectStores.length;a++){var b=(new Date).getTime();this.__actions.push(b),g(this,this.db._objectStores[a],b)}}function c(a){a._aborted||a.__commited||(a.__commited=!0,"readonly"!=this.mode&&a.db.__commit(),a.__active=!1,"function"==typeof a.oncomplete&&(a.target=a,a.target.result=a,a.target.readyState="done",a.oncomplete(a)))}function d(a){this._aborted=!0,a||(a={name:"AbortError",message:"The transaction was aborted."});var c=this;setTimeout(function(){"function"==typeof c.onabort&&(c.target=c,c.target.errorCode=8,c.target.error=a,c.target.readyState="done",c.onabort(c))},b)}function f(a){var b=(new Date).getTime();if(this.__actions.push(b),this.mode!==e.VERSIONCHANGE){for(var c=!1,d=0;d<this.objectStoreNames.length;d++)this.objectStoreNames[d]===a&&(c=!0);if(!c)throw this.__actions.splice(this.__actions.indexOf(b),1),g(this,void 0,b),{name:"NotFoundError"}}for(var f=0;f<this.db._objectStores.length;f++)if(this.db._objectStores[f].name===a){var h=this.db._objectStores[f];return h.transaction=this,g(this,h,b),h}throw this.__actions.splice(this.__actions.indexOf(b),1),g(this,void 0,b),{name:"NotFoundError"}}function g(a,d,e){setTimeout(function(){d?d.__finished()?(a.__actions.splice(a.__actions.indexOf(e),1),0===a.__actions.length&&c(a)):g(a,d,e):0===a.__actions.length&&c(a)},b)}return{abort:d,objectStore:f,__commit:a,__checkFinished:g}}(),j.prototype=function(){function a(b){if("number"==typeof b&&!isNaN(b)||"string"==typeof b||b instanceof Date&&!isNaN(b))return!0;if(b instanceof Array){for(var c=b.length-1;c>=0;c--)if(!a(b[c]))return!1;return!0}return!1}function c(a){return"Object"===a.constructor.name}function d(a){var b={};return a&&"[object Function]"===b.toString.call(a)}function f(a,b){for(var c=b.split("."),d=a,e=0;e<c.length;e++)d&&(d=d[c[e]]);return d}function g(a,b,c){for(var d=b.split("."),e=a,f=0;f<d.length;f++)f!=d.length-1?(e[d[f]]={},e=e[d[f]]):e[d[f]]=c;return e}function h(a){for(var b in a){if(d(a[b]))return!0;if(c(b)&&h(a[b]))return!0}return!1}function i(c){var d=(new Date).getTime(),e=this;e.__actions.push(d);var f={};-1==e.transaction.db.objectStoreNames.indexOf(e.name)&&m(e,f,{name:"InvalidStateError"}),a(c)||m(e,f,{name:"DataError"});var g=e.__data[c];return setTimeout(function(){"function"==typeof f.onsuccess&&(f.target=f,f.target.result=g,f.target.readyState="done",f.onsuccess(f)),e.__actions.splice(e.__actions.indexOf(d),1)},b),f}function j(a,b){return o(this,a,b,!1)}function k(a,b){return o(this,a,b,!0)}function m(a,c,d){return setTimeout(function(){"function"==typeof c.onerror&&(c.target=c,c.target.readyState="done",c.target.error=d,c.onerror(c)),"function"==typeof a.transaction.onerror&&(a.transaction.target=a.transaction,a.transaction.target.readyState="done",a.transaction.target.error=d,a.transaction.onerror(a.transaction)),a.transaction.abort(d)},b),c}function n(a,b,c){throw c&&a.__actions.splice(a.__actions.indexOf(c),1),b}function o(d,i,j,k){var l=(new Date).getTime();d.__actions.push(l);var o={},p=j;if(-1==d.transaction.db.objectStoreNames.indexOf(d.name)&&n(d,{name:"InvalidStateError"},l),d.transaction.mode==e.READONLY&&n(d,{name:"ReadOnlyError"},l),(!d.keyPath&&!j&&!d.autoIncrement||d.keyPath&&(j||!i[d.keyPath]&&!d.autoIncrement||!c(i)))&&n(d,{name:"DataError"},l),d.autoIncrement){if(p&&"number"==typeof p&&p>d.__latestKey||(p=d.__latestKey+1,d.keyPath&&g(i,d.keyPath,p)),p>9007199254740992)return m(d,o,{name:"ConstraintError"});d.__latestKey=p}else d.keyPath&&(p=f(i,d.keyPath));if(a(p)||n(d,{name:"DataError"},l),k&&d.__data[p])return m(d,o,{name:"ConstraintError"});h(i)&&n(d,{name:"DataCloneError"},l);for(var q=0;q<d._indexes.length;q++){var r=d._indexes[q],s=f(i,r.keyPath);if(s)if(r.multiEntry&&s instanceof Array){for(var t={},u=0;u<s.length;u++)if(a(s[u])&&!t[s[u]]&&(t[s[u]]=s[u],r.unique&&r.__data[s[u]]))return m(d,o,{name:"ConstraintError"})}else{if(!a(s))continue;if(r.unique&&r.__data[s])return m(d,o,{name:"ConstraintError"})}}for(var v=0;v<d._indexes.length;v++){var w=d._indexes[v];if(!k)for(var x=0;x<w.__data.length;x++)for(var y=0;y<w.__data[x].length;y++)w.__data[x][y].key==j&&w.__data[x].splice(y,1);var z=f(i,w.keyPath);if(z)if(w.multiEntry&&z instanceof Array)for(var A={},B=0;B<z.length;B++)a(z[B])&&!A[z[B]]&&(A[z[B]]=z[B],w.__data[z[B]]||(w.__data[z[B]]=[]),w.__data[z[B]].push({key:j,data:i}));else{if(!a(z))continue;w.__data[z]||(w.__data[z]=[]),w.__data[z].push({key:j,data:i})}}return d.__data[p]=i,setTimeout(function(){"function"==typeof o.onsuccess&&(o.target=o,o.target.result=p,o.target.readyState="done",o.onsuccess(o)),d.__actions.splice(d.__actions.indexOf(l),1)},b),o}function p(a,b,c){if(this.transaction.mode!==e.VERSIONCHANGE)throw{name:"InvalidStateError"};if(b&&b instanceof Array)for(var d=0;d<b.length;d++)if(""===b[d])throw this.transaction.abort(),{name:"InvalidAccessError"};var f=new l(a,b,c,this);return this._indexes.push(f),this.indexNames.push(a),f}function q(a){if(this.transaction.mode!==e.VERSIONCHANGE)throw{name:"InvalidStateError"};for(var b=!1,c=0;c<this.indexNames.length;c++)this.indexNames[c]===a&&(this.indexNames.splice(c,1),b=!0);if(!b)throw{name:"NotFoundError"};for(var d=0;d<this._indexes.length;d++)this._indexes[d].name===a&&this._indexes.splice(d,1)}function r(a){if(this.mode!==e.VERSIONCHANGE){for(var b=!1,c=0;c<this.indexNames.length;c++)this.indexNames[c]===a&&(b=!0);if(!b)throw{name:"NotFoundError"}}for(var d=0;d<this._indexes.length;d++)if(this._indexes[d].name===a)return this._indexes[d].objectStore=this,this._indexes[d];throw{name:"NotFoundError"}}function s(){return 0===this.__actions.length}return{get:i,add:k,put:j,createIndex:p,deleteIndex:q,index:r,__finished:s}}(),l.prototype=function(){function a(){}return{get:a}}(),a.indexedDBmock=d,a.IDBCursormock=k,a.IDBDatabasemock=h,a.IDBTransactionmock=i,a.IDBObjectStoremock=j,a.IDBRequestmock=j,a.IDBIndexmock=l,a.indexedDBmockDbs=c}(window||self);